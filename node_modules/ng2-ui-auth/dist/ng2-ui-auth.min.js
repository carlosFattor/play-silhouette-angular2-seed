"use strict";function __extends(t,e){function o(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}function __decorate(t,e,o,r){var n,i=arguments.length,a=3>i?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(3>i?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a}function extend(t,e){return Object.keys(e).forEach(function(e){t[e]=t[e]}),t}function joinUrl(t,e){if(/^(?:[a-z]+:)?\/\//i.test(e))return e;var o=[t,e].join("/"),r=function(t){return t.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")};return r(o)}function merge(t,e){var o={};for(var r in t)t.hasOwnProperty(r)&&(r in e&&"object"==typeof t[r]&&null!==r?o[r]=merge(t[r],e[r]):o[r]=t[r]);for(r in e)if(e.hasOwnProperty(r)){if(r in o)continue;o[r]=e[r]}return o}function camelCase(t){return t.replace(/([\:\-\_]+(.))/g,function(t,e,o,r){return r?o.toUpperCase():o})}function NG2_UI_AUTH_PROVIDERS(t){return[angular2_core.provide(Config,{useFactory:function(){return new Config(t)}}),angular2_core.provide(Storage,{useFactory:function(t){return new Storage(t)},deps:[Config]}),angular2_core.provide(Shared,{useFactory:function(t,e){return new Shared(t,e)},deps:[Storage,Config]}),angular2_core.provide(JwtHttp,{useFactory:function(t,e,o,r,n){return new JwtHttp(t,e,o,r)},deps:[angular2_http.XHRBackend,angular2_http.RequestOptions,Shared,Config]}),angular2_core.provide(Oauth,{useFactory:function(t,e,o,r){return new Oauth(t,e,o,r)},deps:[JwtHttp,angular2_core.Injector,Shared,Config]}),angular2_core.provide(Popup,{useFactory:function(t){return new Popup(t)},deps:[Config]}),angular2_core.provide(Oauth1,{useFactory:function(t,e,o){return new Oauth1(t,e,o)},deps:[JwtHttp,Popup,Config]}),angular2_core.provide(Oauth2,{useFactory:function(t,e,o,r){return new Oauth2(t,e,o,r)},deps:[JwtHttp,Popup,Storage,Config]}),angular2_core.provide(Local,{useFactory:function(t,e,o){return new Local(t,e,o)},deps:[JwtHttp,Shared,Config]}),angular2_core.provide(Auth,{useFactory:function(t,e,o){return new Auth(t,e,o)},deps:[Shared,Local,Oauth]})]}var angular2_core=require("angular2/core"),angular2_http=require("angular2/http"),rxjs_Observable=require("rxjs/Observable"),rxjs_add_operator_map=require("rxjs/add/operator/map"),rxjs_add_operator_concatMap=require("rxjs/add/operator/concatMap"),rxjs_add_observable_interval=require("rxjs/add/observable/interval"),rxjs_add_observable_fromEvent=require("rxjs/add/observable/fromEvent"),rxjs_add_operator_take=require("rxjs/add/operator/take"),rxjs_add_operator_takeWhile=require("rxjs/add/operator/takeWhile"),Shared=function(){function t(t,e){this.storage=t,this.config=e,this.tokenName=this.config.tokenPrefix?[this.config.tokenPrefix,this.config.tokenName].join(this.config.tokenSeparator):this.config.tokenName}return t.prototype.getToken=function(){return this.storage.get(this.tokenName)},t.prototype.getPayload=function(){var t=this.getToken();if(t&&3===t.split(".").length)try{var e=t.split(".")[1],o=e.replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(decodeURIComponent(encodeURIComponent(window.atob(o))))}catch(r){return}},t.prototype.setToken=function(t){if(!t)return void console.warn("Can't set token without passing a value");var e;if("string"==typeof t)e=t;else{var o=t&&t.json()&&(t.json().access_token||t.json().token),r=void 0;if(o&&("object"==typeof o&&"object"==typeof o.data?r=o:"string"==typeof o&&(e=o)),!e&&r){var n=this.config.tokenRoot&&this.config.tokenRoot.split(".").reduce(function(t,e){return t[e]},r.data);e=n?n[this.config.tokenName]:r.data[this.config.tokenName]}if(!e){var i=this.config.tokenRoot?this.config.tokenRoot+"."+this.config.tokenName:this.config.tokenName;return void console.warn('Expecting a token named "'+i)}}this.storage.set(this.tokenName,e)},t.prototype.removeToken=function(){this.storage.remove(this.tokenName)},t.prototype.isAuthenticated=function(){var t=this.getToken();if(t){if(3===t.split(".").length)try{var e=t.split(".")[1],o=e.replace(/-/g,"+").replace(/_/g,"/"),r=JSON.parse(window.atob(o)).exp;if(r){var n=Math.round((new Date).getTime()/1e3)>=r;return n?(this.storage.remove(this.tokenName),!1):!0}}catch(i){return!0}return!0}return!1},t.prototype.getExpirationDate=function(){var t=this.getPayload();if(t.exp&&Math.round((new Date).getTime()/1e3)<t.exp){var e=new Date(0);return e.setUTCSeconds(t.exp),e}return null},t.prototype.logout=function(){return this.storage.remove(this.tokenName),rxjs_Observable.Observable.create(function(t){t.next(),t.complete()})},t.prototype.setStorageType=function(t){this.config.storageType=t},t=__decorate([angular2_core.Injectable()],t)}(),Local=function(){function t(t,e,o){this.http=t,this.shared=e,this.config=o}return t.prototype.login=function(t,e){var o=this;e=e||{};var r=e.url?e.url:joinUrl(this.config.baseUrl,this.config.loginUrl);return e.body=JSON.stringify(t)||e.body,e.method=e.method||"POST",this.http.request(r,e).map(function(t){return o.shared.setToken(t),t})},t.prototype.signup=function(t,e){e=e||{};var o=e.url?e.url:joinUrl(this.config.baseUrl,this.config.signupUrl);return e.body=JSON.stringify(t)||e.body,e.method=e.method||"POST",this.http.request(o,e)},t=__decorate([angular2_core.Injectable()],t)}(),Oauth1=function(){function t(t,e,o){this.http=t,this.popup=e,this.config=o}return t.prototype.open=function(e,o){var r=this;this.defaults=extend(e,t.base);var n,i=this.config.baseUrl?joinUrl(this.config.baseUrl,this.defaults.url):this.defaults.url;return this.config.cordova||(n=this.popup.open("",this.defaults.name,this.defaults.popupOptions)),this.http.post(i,JSON.stringify(this.defaults)).concatMap(function(t){return r.config.cordova?n=r.popup.open([r.defaults.authorizationEndpoint,r.buildQueryString(t.json())].join("?"),r.defaults.name,r.defaults.popupOptions):n.popupWindow.location=[r.defaults.authorizationEndpoint,r.buildQueryString(t.json())].join("?"),r.config.cordova?n.eventListener(r.defaults.redirectUri):n.pollPopup()}).concatMap(function(t){return r.exchangeForToken(t,o)})},t.prototype.exchangeForToken=function(t,e){var o=extend({},e);extend(o,t);var r=this.config.baseUrl?joinUrl(this.config.baseUrl,this.defaults.url):this.defaults.url;return this.http.post(r,o)},t.prototype.buildQueryString=function(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")},t.base={url:null,name:null,popupOptions:null,redirectUri:null,authorizationEndpoint:null},t=__decorate([angular2_core.Injectable()],t)}(),Oauth2=function(){function t(t,e,o,r){this.http=t,this.popup=e,this.storage=o,this.config=r}return t.prototype.open=function(e,o){var r=this;this.defaults=merge(e,t.base);var n,i,a=this.defaults.name+"_state",s=this.defaults.state;return"string"==typeof s?this.storage.set(a,s):"function"==typeof s&&this.storage.set(a,s()),n=[this.defaults.authorizationEndpoint,this.buildQueryString()].join("?"),i=this.config.cordova?this.popup.open(n,this.defaults.name,this.defaults.popupOptions).eventListener(this.defaults.redirectUri):this.popup.open(n,this.defaults.name,this.defaults.popupOptions).pollPopup(),i.concatMap(function(t){if("token"===r.defaults.responseType||!r.defaults.url)return t;if(t.state&&t.state!==r.storage.get(a))throw'OAuth "state" mismatch';return r.exchangeForToken(t,o)})},t.prototype.exchangeForToken=function(t,e){var o=this,r=extend({},e);Object.keys(this.defaults.responseParams).forEach(function(e){switch(e){case"code":r[o.defaults.responseParams[e]]=t.code;break;case"clientId":r[o.defaults.responseParams[e]]=o.defaults.clientId;break;case"redirectUri":r[o.defaults.responseParams[e]]=o.defaults.redirectUri;break;default:r[o.defaults.responseParams[e]]=t[e]}}),t.state&&(r.state=t.state);var n=this.config.baseUrl?joinUrl(this.config.baseUrl,this.defaults.url):this.defaults.url;return this.http.post(n,JSON.stringify(r))},t.prototype.buildQueryString=function(){var t=this,e=[],o=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];return o.forEach(function(o){t.defaults[o]&&t.defaults[o].forEach(function(o){var r=camelCase(o),n="function"==typeof t.defaults[o]?t.defaults[o]():t.defaults[r];if("state"===o){var i=t.defaults.name+"_state";n=encodeURIComponent(t.storage.get(i))}"scope"===o&&Array.isArray(n)&&(n=n.join(t.defaults.scopeDelimiter),t.defaults.scopePrefix&&(n=[t.defaults.scopePrefix,n].join(t.defaults.scopeDelimiter))),e.push([o,n])})}),e.map(function(t){return t.join("=")}).join("&")},t.base={defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"}},t=__decorate([angular2_core.Injectable()],t)}(),Oauth=function(){function t(t,e,o,r){this.http=t,this.injector=e,this.shared=o,this.config=r}return t.prototype.authenticate=function(t,e){var o=this,r="1.0"===this.config.providers[t].type?this.injector.get(Oauth1):this.injector.get(Oauth2);return r.open(this.config.providers[t],e||{}).map(function(e){return o.config.providers[t].url&&o.shared.setToken(e),e})},t.prototype.unlink=function(t,e){e=e||{};var o=e.url?e.url:joinUrl(this.config.baseUrl,this.config.unlinkUrl);return e.body=JSON.stringify({provider:t})||e.body,e.method=e.method||"POST",this.http.request(o,e)},t=__decorate([angular2_core.Injectable()],t)}(),Popup=function(){function t(t){this.config=t,this.url="",this.popupWindow=null}return t.prepareOptions=function(t){t=t||{};var e=t.width||500,o=t.height||500;return extend({width:e,height:o,left:window.screenX+(window.outerWidth-e)/2,top:window.screenY+(window.outerHeight-o)/2.5},t)},t.stringifyOptions=function(t){return Object.keys(t).map(function(e){return e+"="+t[e]}).join(",")},t.parseQueryString=function(t){var e,o;return t.split("&").reduce(function(t,r){return r&&(o=r.split("="),e=decodeURIComponent(o[0]),t[e]="undefined"!=typeof o[1]?decodeURIComponent(o[1]):!0),t},{})},t.prototype.open=function(e,o,r){this.url=e;var n=t.stringifyOptions(t.prepareOptions(r)),i=window.navigator.userAgent,a=this.config.cordova||i.indexOf("CriOS")>-1?"_blank":o;return this.popupWindow=window.open(e,a,n),window.popup=this.popupWindow,this.popupWindow&&this.popupWindow.focus&&this.popupWindow.focus(),this},t.prototype.eventListener=function(e){var o=this;return rxjs_Observable.Observable.fromEvent(this.popupWindow,"loadstart").concatMap(function(r){if(!o.popupWindow||o.popupWindow.closed)return["Popup Window Closed"];if(0!==r.url.indexOf(e))return[];var n=document.createElement("a");if(n.href=r.url,n.search||n.hash){var i=n.search.substring(1).replace(/\/$/,""),a=n.hash.substring(1).replace(/\/$/,""),s=t.parseQueryString(a),u=t.parseQueryString(i);if(extend(u,s),o.popupWindow.close(),u.error)throw u.error;return[u]}return[]}).take(1).takeWhile(function(t){return"Popup Window Closed"!==t})},t.prototype.pollPopup=function(){var e=this;return rxjs_Observable.Observable.interval(50).concatMap(function(){if(!e.popupWindow||e.popupWindow.closed)return["Popup Window Closed"];var o=document.location.host,r="";try{r=e.popupWindow.location.host}catch(n){}if(r===o&&(e.popupWindow.location.search||e.popupWindow.location.hash)){var i=e.popupWindow.location.search.substring(1).replace(/\/$/,""),a=e.popupWindow.location.hash.substring(1).replace(/[\/$]/,""),s=t.parseQueryString(a),u=t.parseQueryString(i);if(e.popupWindow.close(),extend(u,s),u.error)throw u.error;return[u]}return[]}).take(1).takeWhile(function(t){return"Popup Window Closed"!==t})},t=__decorate([angular2_core.Injectable()],t)}(),Storage=function(){function t(t){var e=this;this.config=t,this.store={},this.isStorageAvailable=function(){try{var o=t.storageType in window&&null!==window[t.storageType];if(o){var r=Math.random().toString(36).substring(7);window[e.config.storageType].setItem(r,""),window[e.config.storageType].removeItem(r)}return o}catch(n){return!1}}(),this.isStorageAvailable||console.warn(t.storageType+" is not available.")}return t.prototype.get=function(t){return this.isStorageAvailable?window[this.config.storageType].getItem(t):this.store[t]},t.prototype.set=function(t,e){return this.isStorageAvailable?window[this.config.storageType].setItem(t,e):this.store[t]=e},t.prototype.remove=function(t){return this.isStorageAvailable?window[this.config.storageType].removeItem(t):delete this.store[t]},t=__decorate([angular2_core.Injectable()],t)}(),Config=function(){function t(t){var e=this;this.tokenRoot=null,this.cordova=!1,this.baseUrl="/",this.loginUrl="/auth/login",this.signupUrl="/auth/signup",this.unlinkUrl="/auth/unlink/",this.tokenName="token",this.tokenSeparator="_",this.tokenPrefix="ng2-ui-auth",this.authHeader="Authorization",this.authToken="Bearer",this.storageType="localStorage",this.defaultHeaders=null,this.providers={facebook:{name:"facebook",url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:window.location.origin+"/",requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",type:"2.0",popupOptions:{width:580,height:400}},google:{name:"google",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:window.location.origin,requiredUrlParams:["scope"],optionalUrlParams:["display"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",type:"2.0",popupOptions:{width:452,height:633}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:window.location.origin,optionalUrlParams:["scope"],scope:["user:email"],scopeDelimiter:" ",type:"2.0",popupOptions:{width:1020,height:618}},instagram:{name:"instagram",url:"/auth/instagram",authorizationEndpoint:"https://api.instagram.com/oauth/authorize",redirectUri:window.location.origin,requiredUrlParams:["scope"],scope:["basic"],scopeDelimiter:"+",type:"2.0"},linkedin:{name:"linkedin",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",redirectUri:window.location.origin,requiredUrlParams:["state"],scope:["r_emailaddress"],scopeDelimiter:" ",state:"STATE",type:"2.0",popupOptions:{width:527,height:582}},twitter:{name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:window.location.origin,type:"1.0",popupOptions:{width:495,height:645}},twitch:{name:"twitch",url:"/auth/twitch",authorizationEndpoint:"https://api.twitch.tv/kraken/oauth2/authorize",redirectUri:window.location.origin,requiredUrlParams:["scope"],scope:["user_read"],scopeDelimiter:" ",display:"popup",type:"2.0",popupOptions:{width:500,height:560}},live:{name:"live",url:"/auth/live",authorizationEndpoint:"https://login.live.com/oauth20_authorize.srf",redirectUri:window.location.origin,requiredUrlParams:["display","scope"],scope:["wl.emails"],scopeDelimiter:" ",display:"popup",type:"2.0",popupOptions:{width:500,height:560}},yahoo:{name:"yahoo",url:"/auth/yahoo",authorizationEndpoint:"https://api.login.yahoo.com/oauth2/request_auth",redirectUri:window.location.origin,scope:[],scopeDelimiter:",",type:"2.0",popupOptions:{width:559,height:519}},bitbucket:{name:"bitbucket",url:"/auth/bitbucket",authorizationEndpoint:"https://bitbucket.org/site/oauth2/authorize",redirectUri:window.location.origin+"/",requiredUrlParams:["scope"],scope:["email"],scopeDelimiter:",",type:"2.0",popupOptions:{width:1028,height:529}}},Object.keys(t).forEach(function(o){"providers"!==o?e[o]=t[o]:Object.keys(t[o]).forEach(function(o){"undefined"==typeof e.providers[o]?e.providers[o]=t.providers[o]:Object.keys(t.providers[o]).forEach(function(r){e.providers[o][r]=t.providers[o][r]})})})}return t=__decorate([angular2_core.Injectable()],t)}(),JwtHttp=function(t){function e(e,o,r,n){t.call(this,e,o),this._shared=r,this._config=n}return __extends(e,t),e.prototype.request=function(e,o){return e instanceof angular2_http.Request?(e.headers=e.headers||new angular2_http.Headers,this.setHeaders(e)):(o=o||{},this.setHeaders(o)),t.prototype.request.call(this,e,o)},e.prototype.get=function(t,e){return e=e||{},e.method=angular2_http.RequestMethod.Get,this.request(t,e)},e.prototype.post=function(t,e,o){return o=o||{},o.method=angular2_http.RequestMethod.Post,o.body=e,this.request(t,o)},e.prototype.put=function(t,e,o){return o=o||{},o.method=angular2_http.RequestMethod.Put,o.body=e,this.request(t,o)},e.prototype["delete"]=function(t,e){return e=e||{},e.method=angular2_http.RequestMethod.Delete,this.request(t,e)},e.prototype.patch=function(t,e,o){return o=o||{},o.method=angular2_http.RequestMethod.Patch,o.body=e,this.request(t,o)},e.prototype.head=function(t,e){return e=e||{},e.method=angular2_http.RequestMethod.Head,this.request(t,e)},e.prototype.setHeaders=function(t){var e=this;t.headers=t.headers||new angular2_http.Headers,this._config.defaultHeaders&&Object.keys(this._config.defaultHeaders).forEach(function(o){t.headers.has(o)||t.headers.set(o,e._config.defaultHeaders[o])}),this._shared.isAuthenticated()&&t.headers.set(this._config.authHeader,this._config.authToken+" "+this._shared.getToken())},e=__decorate([angular2_core.Injectable()],e)}(angular2_http.Http),Auth=function(){function t(t,e,o){this.shared=t,this.local=e,this.oauth=o}return t.prototype.login=function(t,e){return this.local.login(t,e)},t.prototype.signup=function(t,e){return this.local.signup(t,e)},t.prototype.logout=function(){return this.shared.logout()},t.prototype.authenticate=function(t,e){return this.oauth.authenticate(t,e)},t.prototype.link=function(t,e){return this.oauth.authenticate(t,e)},t.prototype.unlink=function(t,e){return this.oauth.unlink(t,e)},t.prototype.isAuthenticated=function(){return this.shared.isAuthenticated()},t.prototype.getToken=function(){return this.shared.getToken()},t.prototype.setToken=function(t){this.shared.setToken(t)},t.prototype.removeToken=function(){this.shared.removeToken()},t.prototype.getPayload=function(){return this.shared.getPayload()},t.prototype.setStorageType=function(t){this.shared.setStorageType(t)},t.prototype.getExpirationDate=function(){return this.shared.getExpirationDate()},t=__decorate([angular2_core.Injectable()],t)}();exports.Auth=Auth,exports.NG2_UI_AUTH_PROVIDERS=NG2_UI_AUTH_PROVIDERS,exports.Config=Config,exports.Shared=Shared,exports.JwtHttp=JwtHttp;
//# sourceMappingURL=ng2-ui-auth.min.js.map